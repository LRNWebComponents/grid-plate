<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../hax-body-behaviors/hax-body-behaviors.html">
<link rel="import" href="../responsive-grid/responsive-grid-row.html">
<link rel="import" href="../responsive-grid/responsive-grid-col.html">
<!--
`grid-plate`
A grid plate based on a layout that manipulates it.

@demo demo/index.html

@microcopy - the mental model for this element
 -

-->

<dom-module id="grid-plate">
  <template>
    <style>
      :host {
        display: block;
      }
      responsive-grid-col {
        --responsive-grid-col-inner: {
          padding-left: 0;
          padding-right: 0;
        }
      }
    </style>
    <responsive-grid-row gutter="0">
      <template is="dom-if" if="[[!hideCol1]]">
      <responsive-grid-col xl$="[[col1_xl]]" lg$="[[col1_lg]]" md$="[[col1_md]]" sm$="[[col1_sm]]" xs$="[[col1_xs]]">
        <slot name="col-1"></slot>
      </responsive-grid-col>
      </template>
      <template is="dom-if" if="[[!hideCol2]]">
      <responsive-grid-col xl$="[[col2_xl]]" lg$="[[col2_lg]]" md$="[[col2_md]]" sm$="[[col2_sm]]" xs$="[[col2_xs]]">
        <slot name="col-2"></slot>
      </responsive-grid-col>
      </template>
      <template is="dom-if" if="[[!hideCol3]]">
      <responsive-grid-col xl$="[[col3_xl]]" lg$="[[col3_lg]]" md$="[[col3_md]]" sm$="[[col3_sm]]" xs$="[[col3_xs]]">
        <slot name="col-3"></slot>
      </responsive-grid-col>
      </template>
      <template is="dom-if" if="[[!hideCol4]]">
      <responsive-grid-col xl$="[[col4_xl]]" lg$="[[col4_lg]]" md$="[[col4_md]]" sm$="[[col4_sm]]" xs$="[[col4_xs]]">
        <slot name="col-4"></slot>
      </responsive-grid-col>
      </template>
      <responsive-grid-col xl="12" lg="12" md="12" sm="12" xs="12">
        <slot></slot>
      </responsive-grid-col>
    </responsive-grid-row>
  </template>
  <script>
    Polymer({
      is: 'grid-plate',
      behaviors: [HAXBehaviors.PropertiesBehaviors],
      properties: {
        /**
         * Predefined layouts
         */
        layout: {
          type: String,
          value: '12',
          observer: '_layoutChanged',
        },
      },
      /**
       * See layout has changed, update all the possible data values
       */
      _layoutChanged: function(layout) {
        let items = layout.split("/");
        switch (items.length) {
          case 1:
            this.hideCol1 = false;
            this.hideCol2 = true;
            this.hideCol3 = true;
            this.hideCol4 = true;
          break;
          case 2:
            this.hideCol1 = false;
            this.hideCol2 = false;
            this.hideCol3 = true;
            this.hideCol4 = true;
          break;
          case 3:
            this.hideCol1 = false;
            this.hideCol2 = false;
            this.hideCol3 = false;
            this.hideCol4 = true;
          break;
          case 4:
            this.hideCol1 = false;
            this.hideCol2 = false;
            this.hideCol3 = false;
            this.hideCol4 = false;
          break;
        }
        for (var i in items) {
          let col = Number(i)+1;
          this['col' + col + '_xl'] = items[i];
          this['col' + col + '_lg'] = items[i];
          this['col' + col + '_md'] = items[i];
          this['col' + col + '_sm'] = items[i];
          this['col' + col + '_xs'] = items[i];
        }
      },
      /**
       * Attached to the DOM, now fire.
       */
      attached: function() {
        // mutation observer that ensures state of hax applied correctly
        this._observer = Polymer.dom(this).observeNodes(function(info) {
          // MAKE SURE WE KNOW WHAT JUST GOT ADDED HERE
          Polymer.dom.flush();
          // if we've got new nodes, we have to react to that
          if (info.addedNodes.length > 0) {
            info.addedNodes.map((node) => {
              // @todo see if things are in the slot and then
              // render it if needed
              // most important for empty slotted content
              // so that we know whether or not to render
              // the fallback holding area based on misses in
              // the other 3. Template + "slots being there"
              // will help make this calculation
              //console.log(node.getAttribute('slot'));
            });
          }
          // if we dropped nodes via the UI (delete event basically)
          if (info.removedNodes.length > 0) {
            // handle removing items... not sure we need to do anything here
            info.removedNodes.map((node) => {
              //console.log(node);
            });
          }
        });
        // Establish hax property binding
        let props = {
          'canScale': true,
          'canPosition': true,
          'canEditSource': false,
          'settings': {
            'quick': [
            ],
            'configure': [
              {
                'property': 'layout',
                'title': 'Layout',
                'description': 'Style to present these items',
                'inputMethod': 'select',
                'options': {
                  '12' : '1 col, full width',
                  '8/4' : '2 cols, 66% / 33% split',
                  '6/6' : '2 cols, 50% split',
                  '4/8' : '2 cols, 33% / 66% split',
                  '4/4/4' : '3 cols, 33% each',
                  '3/3/3/3' : '4 cols, 25% each',
                },
              },
            ],
            'advanced': [
            ]
          }
        };
        this.setHaxProperties(props);
      },
    });
  </script>
</dom-module>
